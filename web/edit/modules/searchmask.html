
<tal:block metal:define-macro="edit_search">
    <style>
        #sub_content_content{padding:0!important}
        #navigation_content{border-width:0 0 1px 1px!important}
    </style>
    <form class="edit" action="edit_content" method="post" name="changeform" id="changeform">
        <div id="navigation_content">
            <span i18n:translate="edit_searchmask_type">TEXT</span>:
            <input type="image" name="update" value="update" src="/img/s.gif">

            <select name="searchtype" onChange="this.form.submit()">
                <option tal:attributes="selected python:[None,'selected'][searchtype=='none']" value="none" i18n:translate="edit_searchmask_none">TEXT</option>
                <option tal:attributes="selected python:[None,'selected'][searchtype=='parent']" value="parent" i18n:translate="edit_searchmask_parent">TEXT</option>
                <option tal:attributes="selected python:[None,'selected'][searchtype=='own']" value="own" i18n:translate="edit_searchmask_new">TEXT</option>
            </select>
        </div>

        <div id="sub_content_content">
            <div style="padding:20px">
                <input type="hidden" name="tab" value="searchmask"/>
                <input tal:condition="python:selectedfield" type="hidden" name="selectedfield" tal:attributes="value python:selectedfield.id"/>
                <input tal:attributes="value idstr" type="hidden" name="id"/>

                <div metal:use-macro="field_details" id="field_details"></div>

                <input type="hidden" name="isnewfield" id="isnewfield" value=""/>
            </div>
        </div>

        <div id="sub_footer_module"> </div>

    </form>
    <script>
        $(document).ready(function () { // set correct height of scrollable content
           var sublayout = $('#sub_content').layout({applyDemoStyles: true,
                center:{paneSelector: "#sub_content_content", onresize: $.layout.callbacks.resizePaneAccordions},
                north:{paneSelector: "#navigation_content", size:40,resizable:false, closable:false},
                south:{paneSelector: "#sub_footer_module",size:20,closable:false, resizable:false, spacing_open: 0, spacing_closed: 0}
                });
        });
    </script>

</tal:block>

<tal:block metal:define-macro="field_details">
    <table tal:condition="python:searchtype=='own'">
        <tal:block tal:repeat="field searchfields">
            <tal:block tal:condition="python:field!=selectedfield">
                <tr>
                    <td valign="center">
                        <input type="image" tal:attributes="name python:u'open_{}'.format(field.id)" src="/img/boxx.gif"/>
                    </td>
                    <td valign="center" colspan="2">
                        <tal:block tal:content="python:field.name"/>
                        <tal:block tal:condition="python:field.children.count()">
                        <tal:block tal:repeat="f python:field.children.limit(10).all()">
                            <tal:block tal:condition="python:f.type == 'metafield'">
                                <tal:block tal:define="fschema python:f.parents.filter_by(type='metadatatype').first()">
                                <tal:block tal:content="python:fschema and fschema.name or '???'"/>:<tal:block tal:content="python:f.name"/>
                            </tal:block>
                          </tal:block>
                        </tal:block>
                        <tal:block tal:condition="python:field.children.count()>10">...</tal:block>)
                        </tal:block>
                    </td>
                </tr>
            </tal:block>
            <tal:block tal:condition="python:field==selectedfield">
                <tr>
                    <td valign="top">
                        <input type="image" name="close" value="close" src="/img/box.gif"/>
                    </td>
                    <td colspan="2">
                        <input type="text" name="fieldname" tal:attributes="value python:field.name"/>
                        <input type="image" tal:attributes="name python:u'del_{}'.format(field.id)" src="/img/delete.png"/>
                        <table frame="box">
                            <tr>
                                <td colspan="3"><b i18n:translate="edit_searchmask_fieldtitle"/></td>
                            </tr>
                            <tr>
                                <td colspan="3">&nbsp;</td>
                            </tr>
                            <tr tal:condition="python: not field.children.count()">
                                <td colspan="3" i18n:translate="edit_searchfield_none">TEXT</td>
                            </tr>

                            <tr tal:condition="python:field.children.count()">
                                <td><b i18n:translate="edit_searchmask_schema" /></td>
                                <td><b i18n:translate="edit_searchmask_field" /></td>
                                <td>&nbsp;</td>
                            </tr>

                            <tal:block tal:condition="python:field.children.count()" tal:repeat="subfield python:field.children">
                            <tr tal:condition="python:subfield.type == 'metafield'">
                                <tal:block tal:define="ss python:subfield.parents.filter_by(type='metadatatype').first()">
                                    <td tal:content="python:ss and ss.name or '??'"/>
                                </tal:block>
                                <td tal:content="python:subfield.name"/>
                                <td><input type="image" tal:attributes="name python:u'delsub_{}'.format(subfield.id)" src="/img/delete.png"/></td>
                            </tr>
                            </tal:block>
                        </table>

                        <table>
                            <tr>
                                <td>
                                    <select name="schema" onChange="this.form.submit()">
                                        <option value=""></option>
                                        <tal:block tal:repeat="schema schemas">
                                            <option tal:attributes="value python:schema.id; selected python:[None,'selected'][schema.id==defaultschemaid]" tal:content="python:schema.name"></option>
                                        </tal:block>
                                    </select>
                                </td>
                                <td>
                                    <select name="schemafield">
                                        <!--<tal:block tal:condition="schema" tal:repeat="schemafield python:schema.children.sort('name')">-->
                                        <tal:block tal:condition="schema" tal:repeat="schemafield python:schema.children">
                                        <option tal:condition="python:display(schemafield)"
                                            tal:attributes="value python:schemafield.id; selected python:[None,'selected'][schemafield.id==defaultfieldid]"
                                            tal:content="python:schemafield.name"></option>
                                        </tal:block>
                                    </select>
                                </td>
                                <td>
                                    <input type="submit" name="createsub" i18n:attributes="value add"/>
                                </td>
                            </tr>
                        </table>
                        <br/>
                    </td>
                </tr>
            </tal:block>
        </tal:block>
        <tr>
            <td valign="center">
                <input type="image" name="newfield" value="newfield" src="/img/box3.gif"/>
            </td>
            <td valign="center" colspan="2">
               <span style="cursor:pointer;color:#0a5096;" onClick="document.changeform.isnewfield.value='yes';document.changeform.submit()" i18n:translate="edit_searchmask_add"/>
            </td>
        </tr>
    </table>
</tal:block>
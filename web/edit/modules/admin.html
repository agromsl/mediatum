
<tal:block metal:define-macro="edit_admin_file">
    <br/>
    <form tal:attributes="action python:'edit_content?id='+str(id)+'&tab=admin'" method="post" name="meta">
        <table class="files">
            <tr>
                <th colspan="2" i18n:translate="edit_nodeinformation"/>
                <th><input i18n:attributes="title edit_clearfromcache" name="del_cache" type="image" src="/img/update_index.gif"/></th>
            </tr>
            <tr>
                <td i18n:translate="edit_id"/>
                <td colspan="2" tal:content="python:str(node.id)"/>
            </tr>
            <tal:block tal:define="type python:node.type" tal:condition="python:type.find('/')>0">
                <tr>
                    <td i18n:translate="edit_objecttype"/>
                    <td colspan="2" tal:content="python:type.split('/')[0]"/>
                </tr>
                <tr>
                    <td i18n:translate="edit_schema"/>
                    <td colspan="2" tal:content="python:type.split('/')[1]"/>
                <tr>
            </tal:block>
            <tal:block tal:define="type python:node.getType().getName()" tal:condition="python:type.find('/')<0">
                <tr>
                    <td i18n:translate="edit_objectname"/>
                    <td colspan="2" tal:content="type"/>
                </tr>
            </tal:block>
            <tr>
                <td i18n:translate="edit_dirty"/>
                <td tal:content="python:str(node.isDirty())"/>
                <td>
                    <input tal:condition="python:node.isDirty()==0" name="set_dirty" i18n:attributes="title edit_admin_setdirty_title" type="image" src="/img/attention.gif"/>
                    &nbsp;
                </td>
            </tr>
            <tr>
                <td i18n:translate="edit_localread"/>
                <td tal:content="python:str(node.getLocalRead())"/>
                <td>
                    <input name="del_localread" i18n:attributes="title edit_admin_localread_del_title" type="image" src="/img/erase.gif"/>
                </td>
            </tr>
            
            <tr tal:condition="python:len(list(obsoletefields))>0">
                <th colspan="3" i18n:translate="edit_files_obsolete">TEXT</th>
            </tr>
            <tal:block tal:repeat="key python:list(obsoletefields)">
                <tr tal:condition="python:key not in ('rindex','lindex','mindex')">
                    <td style="color: red" tal:content="python:str(key)"/>
                    <td style="color: red; white-space:normal" tal:content="python:str(node.get(str(key)))"/>
                    <td>
                        <input tal:attributes="name python:'attr_'+str(key)" i18n:attributes="title edit_files_obsolete_del_title" type="image" src="/img/delete.png" onClick="return questionDel()"/>
                    </td>
                </tr>
            </tal:block>

            <tr>
                <th colspan="3" i18n:translate="edit_files_metafields">TEXT</th>
            </tr>

            <tr tal:repeat="key python: list(metafields)">
                <td>
                    <b tal:content="key"/>
                </td>
                <td colspan="2" tal:content="python:fd(node.get(key), gf(fields, key))" style="white-space:normal"/>
            </tr>

            <tr>
                <th colspan="3" i18n:translate="edit_files_tech_meta">TEXT</th>
            </tr>

            <tr tal:repeat="key python:list(technfields)">
                <tal:block tal:repeat="sec python:node.getTechnAttributes().keys()">
                    <td tal:condition="python:key in node.getTechnAttributes()[sec].keys()" style="color: #666666" tal:content="raw python:node.getTechnAttributes()[sec][key]"/>
                </tal:block>
                <td style="color: #666666" colspan="2" tal:content="python:str(fd(node.get(key)))"/>
            </tr>

            <tr tal:condition="python:len(technfields)>0">
                <td colspan="3">
                    <button name="deltechn" type="submit" onclick="return questionDel();setActionType('technical')" i18n:translate="edit_files_del_tech_meta">TEXT</button>
                </td>
            </tr>
            <tr>
                <td colspan="3"><hr/></td>
            </tr>
            <tr>
                <th colspan="3" i18n:translate="edit_admin_add_attribute">TEXT</th>
            </tr>
            <tr>
                <td i18n:translate="edit_admin_add_attributename">TEXT</td>
                <td colspan="3"><input type="text" name="new_name"/></td>
            </tr>
            <tr>
                <td i18n:translate="edit_admin_add_attributevalue">TEXT</td>
                <td colspan="3"><input type="text" name="new_value"/></td>
            </tr>
            <tr>
                <td colspan="3">
                    <button name="addattr" type="submit" onclick="setActionType('addattr')" i18n:translate="edit_admin_add_attr">TEXT</button>
                </td>
            </tr>
        </table>
        <div>
            <hr/>
            <button type="button" onclick="getSearchData()" i18n:translate="edit_admin_index_button">TEXT</button>
        </div>
        <div id="searchdata" />
        <input type="hidden" name="type" id="type" value=""/>
    </form>
    <script tal:content="python:'var id='+node.id" />
    <script>
        /*$(document).ready(function() {
            $.get('/edit/edit_content?id='+id+'&tab=admin&action=getsearchdata&style=popup', function(data) {
                $('#searchdata').html(data);
            });
        });*/
        
        function getSearchData(){
            $.get('/edit/edit_content?id='+id+'&tab=admin&action=getsearchdata&style=popup', function(data) {
                $('#searchdata').html(data);
            });
        }
        
        function setActionType(value){
            $("#type").val(value);
        }
    </script>
    
</tal:block>

<tal:block metal:define-macro="searchdata">
    <style>
        div.searchinfo{overflow:auto;width:100%;position:relative;max-height:200px;border:1px solid silver}
    </style>
    <h5 i18n:translate="edit_admin_simplesearch">TEXT</h5>
    <div class="searchinfo">
        <tal:block tal:repeat="i python:searchdata[0]">
            <span tal:content="i">.</span><br/>
        </tal:block>
    </div>
    
    <h5 i18n:translate="edit_admin_extsearch">TEXT</h5>
    <div class="searchinfo">
        <tal:block tal:repeat="i python:searchdata[1]">
            <span tal:content="i">.</span><br/>
        </tal:block>
    </div>
    
    <h5 i18n:translate="edit_admin_textsearch">TEXT</h5>
    <div class="searchinfo">
        <tal:block tal:repeat="i python:searchdata[1]">
            <span tal:content="i">.</span><br/>
        </tal:block>
    </div>
</tal:block>


<metal:block metal:define-macro="list">
</metal:block>

<center metal:define-macro="workflowlist">
    <h2><tal:block i18n:translate="wf_edit_header">Workflows, die von Ihnen bearbeitet werden k&ouml;nnen</tal:block>:</h2>
    <table id="workflowtable" cellspacing="0px">
        <tr>
            <th i18n:translate="wf_edit_name">Name</th>
            <th i18n:translate="wf_edit_description">Beschreibung</th>
        </tr>
        <tr tal:repeat="w list">
            <td>
                <a tal:content="python:w.getName()" tal:attributes="href python:'/publish/'+w.getName()" i18n:attributes="title wf_show_details_title" title="Details anzeigen"/>
            </td>
            <td tal:content="raw python:w.getDescription() or '&nbsp;'"/>
        </tr>
    </table>
</center>

<center metal:define-macro="object_list">
    <h2><span i18n:translate="wf_list_header"><span tal:content="python:str(len(workflow.getNodeList()))" i18n:name="number"/> Objekte im Workflow 
        </span><a tal:attributes="href python:workflow.getLink()"><span tal:replace="python:workflow.getName()"/></a>': 
        <span tal:replace="python:workflow.getDescription()"/>
    </h2>
    <table id="workflowtable" cellspacing="0px">
        <tal:block tal:repeat="step python:workflow.getSteps()">
        <tr tal:attributes="bgcolor python:step.get('adminstep') and '#bec2d3' or None">
            <td align="left"><b tal:content="python:step.getName()"></b></td>
            <td align="left"><a tal:attributes="href python:step.getLink()" i18n:translate="wf_list_objects"><span tal:content="python:str(len(step.getChildren()))" i18n:name="number"/> Objekte</a></td>
        </tr>
        </tal:block>
    </table>
</center>

<center metal:define-macro="workflow_step">
    <h2 i18n:translate="wf_step_ready">Fertig</h2>
    <p i18n:translate="wf_step_msg1">
        Vielen Dank f&uuml;r Ihre Eingabe/Bearbeitung. 
        <br>Das Objekt <span tal:content="python:node.id +' '+node.name" i18n:name="name"/> 
        wurde gespeichert und befindet sich jetzt im Verarbeitungsschritt 
        <span tal:replace="link" i18n:name="link"/>.
    </p>

    <p i18n:translate="workflow_msg5">Falls von Ihrer Seite noch einmal Arbeit an diesem Objekt notwendig sein sollte, werden wir uns per Mail bei Ihnen melden.</p>

    <p i18n:translate="workflow_msg6">Bei Fragen oder Problemen erreichen Sie unser Support-Team unter <span i18n:name="email" tal:replace="email"/></p>
</center>

<tal:block metal:define-macro="workflow_node">
    <p>
        <b i18n:translate="wf_node_msg1">Das Objekt <span tal:content="python:node.id+' '+node.name" i18n:name="name"/> wird gerade verarbeitet.</b>
    </p>
    <p i18n:translate="wf_node_msg2">Der momentane Bearbeitungsschritt (<span tal:content="name" i18n:name="name"/>) l&auml;sst keinen manuellen Eingriff (mehr) zu.</p>
</tal:block>


<tal:block metal:define-macro="workflow_show">
    <h2 i18n:translate="workflow_msg3">Objekte in Schritt <span tal:content="python:step.name" i18n:name="name"/>:</h2>
    <table id="workflowtable" cellspacing="0px">
        <tr>
            <th i18n:translate="workflow_label_id">ID</th>
            <th i18n:translate="workflow_label_date">Datum</th>
            <th i18n:translate="workflow_label_name">Name</th>
            <th i18n:translate="workflow_label_step">Schritt</th>
            <th i18n:translate="workflow_label_editor">Editor</th>
            <th colspan="2" i18n:translate="workflow_label_forward">Weiterleiten</th>
        </tr>
        <tr tal:repeat="node python:step.getChildren().sort('name')">
            <tal:block tal:define="cssclass python:list(step.getChildren().sort('name')).index(node)%2 and 'norm' or 'silver'">
                <td tal:attributes="class cssclass" tal:content="python:node.id"/>
                <td tal:attributes="class cssclass" tal:content="python:format_date(parse_date(node.get('creationtime')),'dd.mm.yyyy HH:MM:SS')"/>
                <td tal:attributes="class cssclass" tal:content="python:node.getName()"/>

                <td tal:attributes="class cssclass"><a tal:attributes="href python:nodelink+node.id" i18n:translate="workflow_show_step">Schritt anzeigen</a></td>
                <td tal:attributes="class cssclass"><a target="editorwindow" tal:attributes="href python:'/edit/edit?id='+node.id" i18n:translate="sub_header_edit">Bearbeiten</a></td>

                <td tal:attributes="class cssclass"><a tal:attributes="href python:nodelink+node.id+'&forcefalse=1'" tal:content="raw python:step.getFalseLabel() or '&nbsp;'"/></td>
                <td tal:attributes="class cssclass"><a tal:attributes="href python:nodelink+node.id+'&forcetrue=1'" tal:content="raw python:step.getTrueLabel() or '&nbsp;'"/></td>
            </tal:block>
        </tr>
        <tr>
            <th colspan="7" align="right">
                <small i18n:translate="workflow_footer">
                    <small tal:content="python:str(len(list(step.getChildren())))" i18n:name="number"/>
                    Elemente im aktuellen Workflowschritt
                </small>
            </th>
        </tr>
    </table>
    <br>
</tal:block>


<tal:block metal:define-macro="workflow_forward">
    <h2 i18n:translate="wf_step_ready">Fertig</h2>
    <p i18n:translate="workflow_msg4">
        Das Objekt <span tal:content="python:node.id" i18n:name="name"/> 
        wurde fertiggestellt und hat den Workflow verlassen.
    </p>
</tal:block>


<tal:block metal:define-macro="workflow_forward2">
    <h2 i18n:translate="wf_step_ready">Fertig</h2>

    <p i18n:translate="wf_step_msg1">Vielen Dank f&uuml;r Ihre Eingabe/Bearbeitung. <br>Das Objekt wurde
    gespeichert und befindet sich jetzt im n&auml;chsten Verarbeitungsschritt.<tal:block i18n:name="name"/></p>
    
    <p i18n:translate="workflow_msg5">Falls von Ihrer Seite noch einmal Arbeit an diesem Objekt notwendig sein sollte, werden wir uns per Mail bei Ihnen melden.</p>

    <p i18n:translate="workflow_msg6">Bei Fragen oder Problemen erreichen Sie unser Support-Team unter <span tal:content="email" i18n:name="email"/></p>

</tal:block>


<tal:block metal:define-macro="workflow_start">
    <h2 i18n:translate="workflow_create_object">Neues Objekt anlegen</h2>

    <tal:block tal:content="raw js"/>

    <form action="/mask" method="post">
        <input type="hidden" name="id" tal:attributes="value python:id">
        <select>
        <tal:block tal:repeat="metadatatype types">
            <option tal:attributes="value python:metadatatype.getName()" 
                    tal:content="python:metadatatype.getLongName()"/>
        </tal:block>
        </select>
        <input i18n:attributes="value workflow_start_submit" type="submit" name="Erstellen" value="Erzeugen">
    </form>
</tal:block>


<table metal:define-macro="workflow_filelist" id="workflowtable">
    <tr tal:condition="python:len(files)!=0">
        <th i18n:translate="workflow_filelist_type">Typ</th>
        <th i18n:translate="workflow_filelist_size">Gr&ouml;&szlig;e</th>
        <th i18n:translate="workflow_filelist_mimetype">Mimetype</th>
        <th i18n:translate="workflow_filelist_loc">Lokation / Name</th>
        <th tal:condition="delbutton">&nbsp;</th>
    </tr>
    <tr tal:repeat="file files">
        <td tal:content="python:file.type"/>
        <td tal:content="python:str(file.getSize())+' bytes'" style="text-align:right;width:100px"/>
        <td tal:content="python:file.mimetype"/>
        <td>
            <a i18n:attributes="title workflow_filelist_open_title" title="Datei anzeigen" target="filewindow" 
             tal:attributes="href python:'/file/'+node.id+'/'+file.getName()" 
             tal:content="python:file.path"/>
        </td>
        <td tal:condition="delbutton">
            <input tal:attributes="name python:'delete_'+file.getName()" i18n:attributes="title workflow_filelist_delete_title" onclick="return questionDel()" type="image" src="/img/delete.png"/>
        </td>
    </tr>
</table>


<tal:block metal:define-macro="workflow_showdata">
    <p tal:content="raw python:prefix"/>
        <table>
            <tr>
                <td tal:repeat="field fields" valign="top" align="left" width="400">
                    <tal:block tal:replace="raw field"/>
                </td>
            </tr>
        </table>

        <tal:block tal:replace="raw filelist"/>
       
        <p tal:content="raw python:suffix"/>
        
        <form action="/mask" method="post">
            <table style="width:100%">
            <input tal:attributes="value key" type="hidden" name="key"/>
            <tal:block tal:replace="raw buttons"/>
            </table>
        </form>
</tal:block>


<tal:block metal:define-macro="workflow_upload">
    <div style="width:800px;text-align: left;margin-top:20px;margin-bottom:20px">
        <tal:block tal:replace="raw prefix"/>
    </div>

    <p tal:condition="python:len(error)>0" tal:content="structure error" class="error"/>

    <form action="/mask" method="post">
        <tal:block tal:replace="raw filelist"/>
        <input type="hidden" name="id" tal:attributes="value id">
        <input type="hidden" name="obj" tal:attributes="value obj">
    </form>

    <h2 i18n:translate="workflow_add_file">Neue Datei hinzuf&uuml;gen:</h2>

    <form action="/mask" method="post" enctype="multipart/form-data" style="padding:4px">
        <div>
            <input type="file" name="file"/>
            <input i18n:attributes="value workflow_upload_button" type="submit" name="submit" value="Hochladen"/>
        </div>
        
        <div style="width:800px;text-align: left;margin-top:20px;margin-bottom:20px">
            <tal:block tal:replace="raw suffix"/>
        </div>

        <table>
            <tal:block tal:replace="raw python:buttons"/>
        </table>
    </form>
</tal:block>


<tal:block metal:define-macro="workflow_metadateneditor">
    <form class="edit" action="/mask" method="post">
        <h2 tal:content="name"/>
        <span tal:replace="raw error"/>
        <input tal:attributes="value key" type="hidden" name="key"/>
        <input type="hidden" name="metaDataEditor" value="metaDataEditor"/>
        <table style="width:800px" cellspacing="0" cellpadding="0">
            <tr>
                <td tal:content="raw mask" align="left"/>
            <tr>
            <tr>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td style="text-align:left"><div class="label">&nbsp;</div><img src="/img/emtyDot1Pix.gif" style="width:16px"/>(<span class="required">*</span> <span i18n:translate="admin_mandatory_info"/>)</td>
            </tr>
            <tal:block tal:content="raw buttons"/>
        </table>
    </form>
</tal:block>


<form metal:define-macro="sendmail" tal:attributes="action page" name="mailuser" method="post">					
    <input type="hidden" name="sendout" value=".">
    <table>
        <tr>
            <td colspan="2">
                    <h3>Mail schicken</h3>
            </td>
        </tr>
        <tr>
            <td>Von: <span class="required">*</span></td>
            <td><input type="text" name="from" tal:attributes="value from" maxlength=50 size="50" /></td>
        </tr>
        <tr>
            <td>An: <span class="required">*</span></td>
            <td><input type="text" name="to" tal:attributes="value to" value="" maxlength=50 size="50" /></td>
        </tr>
        <tr>
            <td>Subject: <span class="required">*</span></td>
            <td><input type="text" name="subject" tal:attributes="value subject" maxlength=50 size="50" /></td>
        </tr>
        <tr>
            <td>Text: <span class="required">*</span></td>
            <td><textarea name="text" tal:content="text" cols="100" rows="30"></textarea></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>
                <button type="submit" name="submit" value="submit" title="Mail abschicken" >Schicken</button>
            </td>
        </tr>
    </table>
</form>


<form metal:define-macro="publish_form" tal:attributes="action python:'/edit/edit_content?id='+str(id)+'&tab=publish'" method="post" style="margin:5px" name="publishform">
    <link rel="stylesheet" href="/css/ftree.css" type="text/css" />
    <script type="text/javascript" src="/js/ftree.js"> </script>
    <script type="text/javascript" tal:content="script"> </script>
    <script type="text/javascript"> 
        var items = new Array();
        var itemnames = new Array();

        function setFolder(){
            check = markFolder(false, "", this.id);
            obj = document.getElementById('Node'+this.id);
            label = obj.getElementsByTagName('A')[0].title;
            if(!check){
                if(items.in_array(this.id)==-1){
                    items.push(this.id);
                }
                if(itemnames.in_array(label)==-1){
                    itemnames.push(label);
                }
            }else{
                pos = items.in_array(this.id);
                if(pos>=0){
                    items = items.slice(0,pos).concat( items.slice(pos+1) );
                }
                
                pos = itemnames.in_array(label);
                if(pos>=0){
                    itemnames = itemnames.slice(0,pos).concat( itemnames.slice(pos+1) );
                }
            }
            names = "";
            if (itemnames.length>0){
                names = "- "+itemnames.join("<br/>- ");
            }
            returnvalues(items, names);
            return false;
        }

        function returnvalues(ids, values){
            var obj = document.getElementById("destination");
            obj.value=ids;
            obj = document.getElementById("dest_names");
            obj.innerHTML = values;
        }
    </script>
    <h3 i18n:translate="edit_publish_header">TEXT</h3>
    <p tal:condition="python:len(faultylist)>0" class="error">
        Objekte mit folgender ID konnten nicht publiziert werden:<br/>
        <tal:block tal:repeat="item faultylist" tal:replace="raw python:'- '+str(id)+'<br/>'"/>
    </p>
    
    <p i18n:translate="edit_publish_info">TEXT</p>
    <div style="height:250px; overflow:auto;border:1px solid silver">
        <ul id="classtree" class="tree">
            <li tal:attributes="id python:'Node'+basedir.id"><a tal:attributes="id python:str(basedir.id); title python:basedir.getLabel()+' ('+str(basedir.id)+')'" tal:content="python:basedir.getLabel()" href="#">TEXT</a>
                <ul>
                    <li tal:attributes="parentId python:basedir.id" class="spinner.gif"><a href="#" id="node_0"> </a></li>
                </ul>
            </li>
        </ul>
    </div>
    <br/>
    <span i18n:translate="edit_publish_dirs">TEXT</span>
    <div id="dest_names" name="dest_names" style="border:1px solid silver;padding:5px;margin:10px 0px;min-height:20px" tal:content="stdname"/>
    <p>
        <input type="hidden" name="destination" id="destination" tal:attributes="value stddir" />
        <button type="submit" name="dopublish" i18n:translate="edit_publish_button">TEXT</button>
    </p>
    <tal:block tal:replace="raw showdir">TEXT</tal:block>
    <script type="text/javascript">
        initTree({'idOfFolderTrees': ['classtree'], 'style':'classification', 'multiselect':true});
    </script>
    <tal:block tal:replace="raw python:'<script type=&quot;text/javascript&quot;>'"/>
        <tal:block tal:repeat="id python:idstr" tal:replace="python:'allobjects[\'check'+id+'\'] = 1;'"/>
    <tal:block tal:replace="raw python:'</script>'"/>
</form>

<metal:block metal:define-macro="reload">
    <tal:block tal:replace="raw python:'<script type=&quot;text/javascript&quot;>'"/>
        <tal:block tal:repeat="item change" tal:replace="raw python:'parent.tree.updateNodeLabel('+item+');'"/>
    <tal:block tal:replace="raw python:'</script>'"/>  
</metal:block>


<tal:block metal:define-macro="no_mask">
    <p>&nbsp;</p>
    <p align="center" i18n:translate="edit_meta_info1">
        TEXT
    </p>
</tal:block>

<tal:block metal:define-macro="edit_metadata">
    <script language="javascript">
        function openPopup(url, name, width, height){
            var win1 = window.open(url,name,'width='+width+',height='+height+',screenX=50,screenY=50,directories=no,location=no,menubar=no,scrollbars=no,status=no,toolbar=no,resizable=no');
            win1.focus();
            return win1;
        }

        function handlelock(name){
            if (document.getElementById('lock_'+name).checked){
                document.getElementById(name).disabled = false;
                document.getElementById(name).value = '';
            }else{
                document.getElementById(name).disabled = true;
                document.getElementById(name).value = '? ';
            }
        }
    </script>
    <tal:block tal:replace="raw python:'<script type=&quot;text/javascript&quot;>'"/>
        <tal:block tal:repeat="id python:idstr.split(',')" tal:replace="python:'parent.tree.updateNodeLabel('+id+')'"/>
    <tal:block tal:replace="raw python:'</script>'"/>
    
    <p tal:condition="python:len(metatypes)>1" class="error" i18n:translate="edit_meta_info2"><span i18n:name="n" tal:content="python:metatypes[0]">TEXT</span></p>

    <form class="edit" action="edit_content" method="post" id="changeform">
        <input type="hidden" name="tab" value="metadata">
        <input tal:attributes="value idstr" type="hidden" name="id">
        <tal:block tal:condition="python:len(masklist)>1">
            <span i18n:translate="edit_meta_mask_selection">TEXT</span>:
            <select name="mask" onChange="this.form.submit()">
                <tal:block tal:repeat="mask masklist">
                    <option tal:attributes="value python:mask.getName();selected python:{'False':None,'True':'selected'}[str(mask.getName()==maskname)]" tal:content="python:{'False':mask.getName(),'True':mask.getDescription()}[str(mask.getDescription()!='')]"/>
                </tal:block>
            </select>
        </tal:block>
        <tal:block tal:condition="python:len(masklist)==1 and masklist[0].getDescription()!=''">
            <span i18n:translate="edit_mask">TEXT</span>: <span tal:content="python:masklist[0].getDescription()">TEXT</span>
        </tal:block>
        <hr/>
    </form>

    <form class="edit" action="edit_content" method="post" id="myform">
        <div class="label">&nbsp;</div>
        <input i18n:attributes="value edit_meta_save" type="submit" name="save"/> 
        <input i18n:attributes="value edit_meta_reset" type="reset"/>
        <br/>
        <br/>
        <tal:block tal:condition="maskform" tal:replace="raw python:maskform"/>
        <tal:block tal:condition="fields">
            <tal:block tal:repeat="field fields">
                <div class="editorrow">
                    <div class="label" tal:content="python:field.getLabel()">TEXT</div>
                    <div id="description">&nbsp;</div>
                    <div id="editor_content">
                        <span tal:define="name python:field.getFieldtype() in ['meta', 'metytype'] and field.getValue() or field.getName(); value python:node.get(name)" tal:replace="structure python:field.getEditorHTML(value, 400)"/>
                    </div>
                </div>
            </tal:block>
        </tal:block>
        <br/>
        <br/>
        <tal:block tal:condition="python:not hasattr(node, 'metaFields') and access.hasWriteAccess(node)">
        <div class="editorrow">
            <div class="label"><tal:block i18n:translate="edit_meta_version_information"/></div>
            <div id="div_description">&nbsp;</div>
            <div id="editor_content">&nbsp;</div>
        </div>
        <br/>
        <div class="editorrow">
            <div class="label"><tal:block i18n:translate="edit_meta_generate_new_version"/></div>
            <div id="div_description">&nbsp;</div>
            <div id="editor_content">
                <input type="checkbox" name="generate_new_version" onchange="onNewVersionChecked(this);return false;" />
            </div>
        </div>
        <div class="editorrow" id="version_comment" style="display:none">
            <div class="label"><tal:block i18n:translate="edit_meta_comment"/>:<span class="required">*</span></div>
            <div id="div_description">&nbsp;</div>
            <div id="editor_content">
                <textarea name="version_comment" rows="4" style="width:380px" tal:content="python:''">TEXT</textarea>
            </div>
        </div>
        <style>
            table.version-list td {
                white-space:normal;
            }
            table.version-list td a {
                font-weight: normal;
                color: #000000;
            }
            table.version-list tr.active {
                background: #f1f1f1;
            }
            table.version-list tr th {
                background: #d6d6d6;
                color: #5e5e5e;
            }
        </style>
        <script language="javascript">
            function onNewVersionChecked (self) {
                if (self.checked) {
                    document.getElementById('version_comment').style.display = 'block';
                } else {
                    document.getElementById('version_comment').style.display = 'none';
                }
            }
        </script>
        <div class="editorrow">
            <div class="label">&nbsp;</div>
            <div id="div_description">&nbsp;</div>
            <div id="editor_content">
                <table class="version-list" width="380" cellspacing="1" cellpadding="5">
                    <tr>
                        <th><tal:block i18n:translate="edit_meta_version"/></th>
                        <th><tal:block i18n:translate="edit_meta_delete"/></th>
                        <th><tal:block i18n:translate="edit_meta_restore"/></th>
                        <th><tal:block i18n:translate="edit_meta_timestamp_comment"/></th>
                        <th><tal:block i18n:translate="edit_meta_updateduser"/></th>
                    </tr>
                    <tal:block tal:repeat="v versions">
                    <tr tal:attributes="class python:(v.next_nid=='0' or v.next_nid==None) and 'row active' or 'row' ">
                        <td><a href="/" tal:attributes="href python:'?id='+v.id+'&amp;tab=metadata'" tal:content="python:'V' + str(v.get('system.version.id')=='' and 1 or v.get('system.version.id'))">Version</a></td>
                        <td><a href="/" tal:attributes="href python:'?id='+node.id+'&amp;tab=metadata&amp;action=delete&amp;vid='+v.id; onclick python:'if(!confirm(deleteConfirm'+v.id+'))return false;;'"><tal:block i18n:translate="edit_meta_delete"/></a></td>
                        <td><a href="/" tal:attributes="href python:'?id='+node.id+'&amp;tab=metadata&amp;action=restore&amp;vid='+v.id; onclick python:'if(!confirm(restoreConfirm'+v.id+'))return false;;'"><tal:block i18n:translate="edit_meta_restore"/></a></td>
                        <td>
                        <div tal:content="python:v.getUpdatedDate()"></div>
                        <div tal:content="python:v.get('system.version.comment')"></div>
                        </td>
                        <td>
                        <div tal:content="python:v.get('updateuser') and v.get('updateuser') or v.get('creator')"></div>
                        <tal:block tal:replace="raw python:'<script type=&quot;text/javascript&quot;>'"/>
                            <tal:block tal:replace="raw python:'var deleteConfirm'+v.id+'=\''"/><tal:block i18n:translate="edit_meta_delete_confirm"><tal:block i18n:name="version" tal:replace="python:v.get('system.version.id')=='' and 1 or v.get('system.version.id')" /></tal:block><tal:block tal:replace="raw python:'\';'"/>
                            <tal:block tal:replace="raw python:'var restoreConfirm'+v.id+'=\''"/><tal:block i18n:translate="edit_meta_restore_confirm"><tal:block i18n:name="version" tal:replace="python:v.get('system.version.id')=='' and 1 or v.get('system.version.id')" /></tal:block><tal:block tal:replace="raw python:'\';'"/>
                        <tal:block tal:replace="raw python:'</script>'"/>  
                        </td>
                    </tr>
                    </tal:block>
                </table>
            </div>
        </div>
        </tal:block>
        <br/>
        <br/>
        <div class="label">&nbsp;</div>
        <small>(<span class="required">*</span> <span i18n:translate="edit_mask_required">TEXT</span>)</small>
        <br/>
        <br/>
        <div class="label">&nbsp;</div>
        <input i18n:attributes="value edit_meta_save" type="submit" name="save"/> 
        <input i18n:attributes="value edit_meta_reset" type="reset"/>
        <br/>
        <input tal:attributes="value maskname" type="hidden" name="mask"/>
        <input type="hidden" name="tab" value="metadata"/>
        <input tal:attributes="value idstr" type="hidden" name="id"/>
        <input type="hidden" name="edit_metadata" value="edit_metadata"/>
    </form>


    <br>
    <small style="color: silver">
        <span tal:condition="python:len(creation_date)>0"><span i18n:translate="edit_meta_created">TEXT</span>: </span>
        <tal:block tal:repeat="c_date creation_date" tal:content="raw python:c_date[0] + ' ('+c_date[1]+')' "/>
        <br/>
        <span tal:condition="python:len(update_date)>0"><span i18n:translate="edit_meta_changed">TEXT</span>: </span>
        <tal:block tal:repeat="u_date update_date" tal:content="raw python:u_date[0] + ' ('+u_date[1]+')' "/>
    </small>
    <br/>
    <tal:block tal:replace="raw python:'<script type=&quot;text/javascript&quot;>'"/>
        <tal:block tal:repeat="id python:idstr.split(',')" tal:replace="python:'allobjects['+id+']=1;'"/>
    <tal:block tal:replace="raw python:'</script>'"/>
</tal:block>
    
<metal:block metal:define-macro="redirect">
    <tal:block tal:replace="raw python:'<script type=&quot;text/javascript&quot;>'"/>
        <tal:block tal:condition="pid" tal:replace="raw python:'parent.tree.updateNodeLabel('+pid+');'"/>
        <tal:block tal:replace="raw python:'window.location.href=\''+url+'\';'"/>
    <tal:block tal:replace="raw python:'</script>'"/>  
</metal:block>

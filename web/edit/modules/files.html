
<p metal:define-macro="filetype_error" style="color:red" i18n:translate="edit_files_filetype_error">
    TEXT
</p>

<p class="error" metal:define-macro="version_error"><tal:block i18n:translate="fieldsmissing">TEXT</tal:block><br/><tal:block i18n:translate="saved_in_inconsistent_data">TEXT</tal:block></p>


<tal:block metal:define-macro="edit_files_file">
    <style type="text/css">
        #filetable{
            border:0px solid silver; border-width:1px 1px 0px 1px; width:90%
        }
        #filetable input{
            background-color:transparent; margin:1px; border-width:0px
        }
        #filetable input:hover{
            border-width:0px
        }
        #filetable input[type="text"]{
            border:1px solid silver
        }
        #filetable input[type="text"]:hover{
            border:1px solid black; background-color:#ffffff
        }

        #filetable th{
            background-color:#d8d8d8; padding:3px 5px 2px 3px; border-bottom:1px solid silver; font-variant:small-caps
        }
        #filetable th.header{
            background-color:#FFFFFF; padding:3px 5px 2px 3px; border-bottom:1px solid silver; font-variant:small-caps; height:30px; vertical-align:bottom
        }
        #filetable tr{
            border:1px solid silver
        }
        #filetable td{
            vertical-align:middle; padding:2px;border-bottom:1px solid silver
        }
        #filetable tr:hover{
            background-color:silver
        }
        #filetable a{
            color:#000000; padding:1px:margin:0px
        }
        td.silver{
            background-color:#efefef
        }
        
        .sortable-default{
            float:left; width:130px; height:130px; position:relative;cursor:move
        }
        
        </style>
    <br/>
    <tal:block tal:condition="python:update_error">
        <p class="error" i18n:translate="file_processingerror">TEXT</p>
    </tal:block>

    <script>
        function removeItem(id, parent){
            $.get('/edit/edit_content?id='+parent+'&tab=files&style=popup&data=translate&msgstr=edit_files_removequestion&jsoncallback=?', function(data) {
                if (confirm(unescape(data))){
                    $.get('/edit/edit_content?id='+parent+'&tab=files&style=popup&data=removeitem&remove='+id+'&jsoncallback=?', function(data) {
                      $('#childnodes').html(data);
                      return false;
                    });
                }
            });
            return false;
        }
        
        function saveOrder(id){
            $.get('/edit/edit_content?id='+id+'&tab=files&style=popup&data=reorder&order='+$(".sortlist").html()+'&jsoncallback=?', function(data){});
            $("#orderdiv").css("display", "none");
            return false;
        }
    </script>
    <div tal:condition="python:not node.isContainer()" tal:define="children python:node.getChildren().sort()" style="overflow:hidden;margin:3px;">
        <p><b i18n:translate="edit_files_childobjects">TEXT</b></p>
        <a tal:attributes="onclick python:'openWindow(\'/edit/edit_content?id='+node.id+'&tab=files&style=popup&parent=\'+window.parent.tree.getFolder())'" target="_blank" i18n:attributes="title edit_files_add_title" style="cursor:pointer">
            <div style="border:1px solid #A4A4A4; width:126px;height:126px;float:left;margin-right:2px;text-align:center">
                <div style="color:#A4A4A4;font-size:50px;padding-top:30px;padding-left:45px">+</div>
            </div>
        </a>
        <div id="childnodes" style="overflow:hidden"> 
            <div id="sortable" class="connectedSortable" style="height:130px;width:100%">
                <div tal:repeat="child python:node.getChildren().sort()" class="sortable-default" tal:attributes="id python:child.id">
                    <img tal:attributes="id python:child.id; src python:'/thumbs/'+child.id"/>
                    <div style="position:absolute;top:2px;right:4px">
                        <a tal:attributes="href python:'/edit/edit_content?id='+child.id+'&tab=metadata'" i18n:attributes="title edit_files_edit_child"><img src="/img/edit.png"/></a>
                        <a href="#" tal:attributes="onclick python:'return removeItem(this.id, '+node.id+')';id python:child.id" i18n:attributes="title edit_files_delete_child"><img src="/img/delete.png"/></a>
                    </div>
                </div>
            </div>
            <tal:block i18n:translate="edit_files_order_label">TEXT</tal:block>
            <div class="sortlist" style="display:none"> </div>
            <div id="orderdiv" style="display:none"><button type="button" tal:attributes="onclick python:'saveOrder('+node.id+')'" i18n:translate="edit_files_order_save">TEXT</button></div>
        </div>
    </div>
    
    <hr/>
    <form method="post" tal:condition="python:len(files)>0">
        <table id="filetable" cellpadding="0px" cellspacing="0px">
            <tr><th colspan="5" class="header" i18n:translate="edit_files_files">TEXT</th></tr>
            <tr>
                <th i18n:translate="edit_files_type">TEXT</th>
                <th i18n:translate="edit_files_size">TEXT</th>
                <th i18n:translate="edit_files_mimetype">TEXT</th>
                <th i18n:translate="edit_files_location">TEXT</th>
                <th i18n:translate="edit_files_options">TEXT</th>
             </tr>

            <tr tal:repeat="file python:files">
                <tal:block tal:condition="python:file.type!='attachment' and (user.isAdmin() or file.type!='statistic')">
                <td tal:content="python:file.type"/>
                <td tal:content="python:file.getSize()"/>
                <td tal:content="python:file.mimetype"/>
                <td>
                    <a tal:attributes="href python:'/file/'+str(node.id)+'/'+file.getName()" tal:content="python:file.getName()" i18n:attributes="title edit_files_open_title" target="filewindow"/>
                </td>
                <td style="text-align:center"><input tal:condition="python:file.type not in ['original', 'image']" tal:attributes="name python:'del|'+file.type+'|'+file.getName()" type="image" src="/img/delete.png" onclick="return questionDelName('')"/>&nbsp;</td>
                </tal:block>
            </tr>
            
            <tal:block tal:condition="python:len(attfiles)>0">
            <tr><th colspan="5" class="header" i18n:translate="edit_files_attachments">TEXT</th></tr>
            <tr>
                <th i18n:translate="edit_files_type">TEXT</th>
                <th i18n:translate="edit_files_size">TEXT</th>
                <th i18n:translate="edit_files_mimetype">TEXT</th>
                <th i18n:translate="edit_files_location">TEXT</th>
                <th i18n:translate="edit_files_options">TEXT</th>
            </tr>
            <tr tal:repeat="file attfiles">
                <td tal:content="python:file.type"/>
                <td tal:content="python:file.getSize()"/>
                <td tal:content="python:file.mimetype"/>
                <td>
                    <a tal:condition="python:file.getSize()>0" tal:attributes="href python:'/file/'+str(node.id)+'/'+file.getName()" tal:content="python:file.getName()" i18n:attributes="title edit_files_open_title" target="filewindow"/>
                    <b tal:condition="python:file.getSize()==0" tal:content="python:file.getName()"/>
                </td>
                <td style="text-align:center"><input tal:condition="python:file.type not in ['original', 'image']" tal:attributes="name python:'del|'+file.type+'|'+file.getName()" type="image" src="/img/delete.png" onclick="return questionDelName('')"/>&nbsp;</td>
            </tr>
            <tr tal:repeat="file att">
                <td tal:content="python:' - '+file.type"/>
                <td tal:content="python:file.getSize()"/>
                <td tal:content="python:file.mimetype"/>
                <td>
                    <a tal:condition="python:file.getSize()>0" tal:attributes="href python:'/attfile/'+str(node.id)+'/'+file._path" tal:content="python:file.getName()" i18n:attributes="title edit_files_open_title" target="filewindow"/>
                    <b tal:condition="python:file.getSize()==0" tal:content="python:file.getName()"/>
                </td>
                <td style="text-align:center"><input tal:condition="python:file.type not in ['original', 'image']" tal:attributes="name python:'delatt|'+file.type+'|'+file.getName()" type="image" src="/img/delete.png" onclick="return questionDelName('')"/>&nbsp;</td>
            </tr>
            </tal:block>
            
            <tal:block tal:condition="python:len(statfiles)>0">
            <tr><th colspan="5" class="header" i18n:translate="edit_files_stats">TEXT</th></tr>
            <tr>
                <th i18n:translate="edit_files_type">TEXT</th>
                <th i18n:translate="edit_files_size">TEXT</th>
                <th i18n:translate="edit_files_mimetype">TEXT</th>
                <th i18n:translate="edit_files_location">TEXT</th>
                <th i18n:translate="edit_files_options">TEXT</th>
            </tr>
            <tr tal:repeat="file statfiles">
                <td tal:content="python:file.type"/>
                <td tal:content="python:file.getSize()"/>
                <td tal:content="python:file.mimetype"/>
                <td>
                    <a tal:attributes="href python:'/file/'+str(node.id)+'/'+file.getName()" tal:content="python:file.getName()" i18n:attributes="title edit_files_open_title" target="filewindow"/>
                </td>
                <td style="text-align:center"><input tal:condition="python:file.type not in ['original', 'image']" tal:attributes="name python:'del|'+file.type+'|'+file.getName()" type="image" src="/img/delete.png" onclick="return questionDelName('')"/>&nbsp;</td>
            </tr>  
            </tal:block>
            
        </table>
        <input type="hidden" name="operation" value="delete"/>
    </form>
    
    <hr/>
    <form method="post" enctype="multipart/form-data">
        <b><tal:block i18n:translate="edit_files_change">TEXT</tal:block>:</b>
        <p>
            <input type="radio" name="change_file" value="yes" checked="checked" onclick="setInput('')" style="border:1px solid white"/><tal:block i18n:translate="edit_files_change"/>
            <br/>
            <input type="radio" name="change_file" value="no" onclick="setInput('')" style="border:1px solid white"/><tal:block i18n:translate="edit_files_add_obj"/>
            <br/>
            <input type="radio" name="change_file" value="attdir" onclick="setInput('dir')" style="border:1px solid white"/><tal:block i18n:translate="edit_files_add_attdir"/>
            <br/>
            <input type="radio" name="change_file" value="attfile" onclick="setInput('')" style="border:1px solid white"/><tal:block i18n:translate="edit_files_add_attfile"/>
            <br/>
        </p>

        <span id="inputname" style="display:none"><tal:block i18n:translate="edit_files_dirname">TEXT</tal:block> <input type="text" name="inputname" size="60"/></span>
        <br/>
        <span id="updatefile"><tal:block i18n:translate="edit_files_choosefile">TEXT</tal:block> <input name="updatefile"  type="file" size="50"/></span>
        <span id="generate_new_version" tal:condition="python:not hasattr(node, 'metaFields') and access.hasWriteAccess(node)">
            <br/>
            <br/>
            <br/>
            <input type="checkbox" name="generate_new_version" onchange="onNewVersionChecked(this);return false;" />
            <tal:block i18n:translate="edit_files_create_a_new_version_with_uploading">TEXT</tal:block>
            <br/>
            <span id="version_comment">
            <br/>
            <b><tal:block i18n:translate="edit_files_comment">TEXT</tal:block>:<span class="required">*</span></b>
            <br/>
            <textarea name="version_comment" rows="4" style="width:380px" tal:content="python:''">TEXT </textarea>
            </span>
        </span>
        <p>
            <button i18n:attributes="title edit_upload_upload_label" i18n:translate="edit_upload_upload_label" type="submit" name="addfile" value="submit">TEXT</button>
        </p>
        <input type="hidden" name="operation" value="change"/>
        <script>
            function setInput(item){
                if(item=="dir"){
                    document.getElementById('inputname').style.display = 'block';
                }else{
                    document.getElementById('inputname').style.display = 'none';
                }
            }

            $("#sortable" ).sortable({
                connectWith: ".connectedSortable",
                stop: function(event, ui) {
                    $('.connectedSortable').each(function() {
                        result = "";
                        $(this).find("img").each(function(){
                            if ($(this).attr("id")){
                                result += $(this).attr("id") + ",";
                            }
                        });
                        if(result!=""){
                            $("#orderdiv").css("display", "block");
                            $(".sortlist").html(result);
                        }
                    });
                }
            });
        </script>
        <script language="javascript">
            $('#version_comment').hide();
            function onNewVersionChecked (self) {
                if (self.checked) {
                    $('#version_comment').show();
                } else {
                    $('#version_comment').hide();
                }
            }
        </script>
    </form>

    <hr/>
    <form method="post" enctype="multipart/form-data">
        <b i18n:translate="edit_files_addthumbnail">TEXT</b>
        <p>
            <input name="updatefile" type="file" size="50"/>
        </p>
        <p>
            <button i18n:attributes="title edit_upload_upload_label" i18n:translate="edit_upload_upload_label" type="submit" name="addthumbfile" value="submit">TEXT</button>
        </p>
        <input type="hidden" name="operation" value="addthumb"/>
    </form>
    
    <hr/>
    <form method="post">
        <p><input i18n:attributes="value edit_files_reprocess" type="submit" name="postprocess"></p>
        <p><small i18n:translate="edit_files_reprocess_info">TEXT</small></p>
        <input type="hidden" name="operation" value="postprocess"/>
    </form>
</tal:block>

<tal:block metal:define-macro="edit_files_children_list">
    <div tal:repeat="child children" style="float:left;width:128px;height:128px;padding-right:2px;position:relative">
        <a tal:attributes="href python:'/edit/edit_content?id='+child.id+'&tab='+child.getDefaultEditTab()"><img tal:attributes="src python:'/thumbs/'+child.id"/></a>
        <div style="position:absolute; top:2px;right:4px">
            <a tal:attributes="href python:'/edit/edit_content?id='+child.id+'&tab=metadata'"><img src="/img/edit.png"/></a>
            <a href="#" tal:attributes="onclick python:'return removeItem(this.id, '+node.id+')';id python:child.id"><img src="/img/delete.png"/></a>
        </div>
    </div>
</tal:block>

<tal:block metal:define-macro="edit_files_popup_children">
    <tal:block tal:repeat="child children">
    <div tal:condition="python:not child.isContainer()" style="float:left; margin:2px 2px 0px 0px; border:1px solid silver; position:relative">
        <img tal:attributes="src python:'/thumbs/'+child.id"/>
        <div style="position:absolute;top:1px;right:1px">
            <input tal:attributes="value python:child.id" name="items_add" id="items_add" type="checkbox" style="margin:0px; padding:0px"/>
        </div>
    </div>
    </tal:block>
</tal:block>

<tal:block metal:define-macro="edit_files_popup_selection">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta content="text/html;charset=UTF-8" http-equiv="content-type"/>
        <link rel="stylesheet" href="/css/editor.css" />
        <link rel="stylesheet" href="/css/edit_style.css" />
        <link rel="stylesheet" href="/css/ftree.css" type="text/css" />
        
        <script type="text/javascript" src="/js/ftree.js"> </script>
        <script type="text/javascript" language="javascript" src="http://code.jquery.com/jquery-latest.js"> </script>
        <script type="text/javascript" src="/js/mediatum.js"> </script>
    </head>
    <body>
        <script type="text/javascript" tal:content="script"> </script>
        <script type="text/javascript"> 
            function setFolder(){
                markFolder(true, "", this.id);
                getFolderItems(this.id);
                return false;
            }
            
            function getFolderItems(id){
                $.get('/edit/edit_content?style=popup&tab=files&data=children&id='+id+'&jsoncallback=?', function(data) {
                  $('#files').html(data);
                });
            }
            
            function selectedItems(){
                var val = "";
                $(":checkbox:checked[name=items_add]").each(
                    function() {
                        val += $(this).val()+";";
                    }
                );
                $.get('/edit/edit_content?style=popup&tab=files&data=additems&id='+node+'&items='+val, function(data) {
                  opener.$('#childnodes').html(data);
                  self.close();
                });
            }
        </script>
        <form>
        <h1 i18n:translate="edit_files_choosedirectory">TEXT</h1>
        <div style="height:340px; overflow:auto;border:1px solid silver;background-color:white">
            <ul id="tree" class="tree">
                <li tal:repeat="basedir basedirs" tal:attributes="id python:'Node'+basedir.id"><a tal:attributes="id python:str(basedir.id); title python:basedir.getLabel()+' ('+str(basedir.id)+')'" tal:content="python:basedir.getLabel()" href="#">TEXT</a>
                    <ul>
                        <li tal:attributes="parentId python:basedir.id" class="spinner.gif"><a href="#" id="node_0"> </a></li>
                    </ul>
                </li>
            </ul>
        </div>
        <h1 i18n:translate="edit_files_choosefile">TEXT</h1>
        <div style="border:1px solid silver;height:300px;overflow:auto" id="files">
        </div>
        <p style="text-align:center">
            <button type="button" style="width:150px;margin-right:50px;background-color:white" onclick="selectedItems()" i18n:translate="edit_ok">TEXT</button>
            <button type="button" style="width:150px" onclick="self.close()" i18n:translate="edit_cancel">TEXT</button>
        </p>
        </form>
        <script type="text/javascript">
            initTree({'idOfFolderTrees': ['tree'], 'multiselect':false});
        </script>
        <tal:block tal:replace="raw python:'<script type=&quot;text/javascript&quot;>'"/>
            <tal:block tal:repeat="id python:idstr.split(',')" tal:replace="python:'allobjects['+id+']=1;'"/>
        <tal:block tal:replace="raw python:'</script>'"/>
        <script>
            getFolderItems(currentfolder);
        </script>
    </body>
</html>
</tal:block>
